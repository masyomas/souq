<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ§¾ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</title>
<style>
  body { font-family:'Tahoma',sans-serif; margin:0; padding:0; background:#fff; text-align:center; }
  header { background:#007bff; color:#fff; padding:12px; font-size:20px; }
  section { margin:20px auto; width:90%; max-width:600px; }
  select, button, textarea { width:90%; padding:8px; margin:8px 0; font-size:15px; border:1px solid #ccc; border-radius:4px; }
  button { background:#28a745; color:#fff; cursor:pointer; }
  button:hover { background:#218838; }
  #totalBox { margin-top:10px; font-size:17px; font-weight:bold; color:#333; }
  footer { background:#f1f1f1; padding:8px; font-size:13px; color:#777; margin-top:10px; }
</style>
</head>
<body>

<header>ğŸ§¾ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</header>

<section>
  <label for="clientCode">Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
  <select id="clientCode">
    <option value="">-- Ø§Ø®ØªØ± --</option>
  </select>

  <button onclick="matchInvoice()">ğŸ“‹ Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>

  <textarea id="invoiceBox" rows="8" readonly placeholder="Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³Ù„Ø¹ Ø§Ù„Ù…Ø´ØªØ±Ø§Ø©..."></textarea>
  
  <div id="totalBox">ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø¬Ù†ÙŠÙ‡</div>
</section>

<footer>ğŸ’ Powered by Almasa ğŸ’</footer>

<script>
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
  let users = JSON.parse(localStorage.getItem('users') || '[]');
  let purchases = JSON.parse(localStorage.getItem('purchases') || '[]');

  let select = document.getElementById('clientCode');

  users.forEach(u => {
    if(u.code) {
      let opt = document.createElement('option');
      opt.value = u.code;
      opt.text = `${u.name} - ÙƒÙˆØ¯: ${u.code}`;
      select.appendChild(opt);
    }
  });

  function matchInvoice(){
    let code = document.getElementById('clientCode').value;
    if(!code){ alert('âš ï¸ Ø§Ø®ØªØ± ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹'); return; }

    let userPurchases = purchases.filter(p => p.code == code);
    if(userPurchases.length == 0){
      document.getElementById('invoiceBox').value = "ğŸ“¦ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„.";
      document.getElementById('totalBox').textContent = "ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0 Ø¬Ù†ÙŠÙ‡";
      return;
    }

    let result = "";
    let total = 0;
    userPurchases.forEach(p => {
      let qty = parseInt(p.qty) || 1;
      let price = parseFloat(p.price) || 0;
      let subtotal = qty * price;
      total += subtotal;
      result += `â€¢ ${p.product} Ã— ${qty} Ø¨Ø³Ø¹Ø± ${price} Ø¬Ù†ÙŠÙ‡ = ${subtotal} Ø¬Ù†ÙŠÙ‡\n`;
    });

    document.getElementById('invoiceBox').value = result;
    document.getElementById('totalBox').textContent = `ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬Ù†ÙŠÙ‡`;
  }
</script>

</body>
</html>
